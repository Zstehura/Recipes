@inject NavigationManager Navigation
@implements IDisposable

<div class="nav-scrollable">
    <div class="nav-header px-3 py-3">
        <h2 class="nav-title">Recipes App</h2>
    </div>
    <nav class="flex-column">
        <div class="nav-item px-3">
            <button class="nav-button @(IsActiveRoute("/") ? "active" : "")" @onclick="@(() => NavigateTo("/"))">
                <span class="bi bi-list-ul" aria-hidden="true"></span> All Recipes
            </button>
        </div>
        <div class="nav-item px-3">
            <button class="nav-button @(IsActiveRoute("/search-by-ingredients") ? "active" : "")" @onclick="@(() => NavigateTo("/search-by-ingredients"))">
                <span class="bi bi-search" aria-hidden="true"></span> Search by Ingredients
            </button>
        </div>
        <div class="nav-item px-3">
            <button class="nav-button @(IsActiveRoute("/recipe/new") ? "active" : "")" @onclick="@(() => NavigateTo("/recipe/new"))">
                <span class="bi bi-plus-circle" aria-hidden="true"></span> New Recipe
            </button>
        </div>
        <div class="nav-item px-3">
            <button class="nav-button @(IsActiveRoute("/ingredients") ? "active" : "")" @onclick="@(() => NavigateTo("/ingredients"))">
                <span class="bi bi-list-check" aria-hidden="true"></span> Ingredients
            </button>
        </div>
    </nav>
</div>

@code {
    protected override void OnInitialized()
    {
        Navigation.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        StateHasChanged();
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }

    private string GetCurrentUri()
    {
        var uri = Navigation.ToBaseRelativePath(Navigation.Uri);
        return "/" + uri.TrimStart('/');
    }

    private bool IsActiveRoute(string route)
    {
        var currentUri = GetCurrentUri();
        
        if (route == "/")
        {
            return currentUri == "/" || string.IsNullOrEmpty(currentUri.TrimStart('/'));
        }
        
        return currentUri.Equals(route, StringComparison.OrdinalIgnoreCase) ||
               currentUri.StartsWith(route + "/", StringComparison.OrdinalIgnoreCase);
    }

    private void NavigateTo(string route)
    {
        Navigation.NavigateTo(route);
    }
}
